<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FeatureBench Tasks</title>
    <link rel="icon" type="image/jpeg" href="../leaderboard/logos/logo.jpg" />
    <meta name="description" content="FeatureBench task cards from Lite and Full splits." />
    <script>
      (() => {
        let stored = null;
        try {
          stored = localStorage.getItem("featurebench.theme");
        } catch {
          stored = null;
        }
        const prefersDark =
          window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
        const theme =
          stored === "dark" || stored === "light" ? stored : prefersDark ? "dark" : "light";
        document.documentElement.dataset.theme = theme;
      })();
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700;800&family=Plus+Jakarta+Sans:wght@500;600;700;800&family=IBM+Plex+Mono:wght@500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../assets/css/topbar.css" />
    <style>
      :root {
        color-scheme: light;
        --bg: #f7f8fb;
        --surface: #ffffff;
        --surface-soft: #f6f8fc;
        --text: #0f1728;
        --muted: #5c677d;
        --line: #dde4ef;
        --line-strong: #c7d1e0;
        --accent-soft: #2f5dff;
        --focus: #2f5dff;
        --font-ui: "Manrope", "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
        --font-head: "Plus Jakarta Sans", "Manrope", "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
        --font-mono: "IBM Plex Mono", "SFMono-Regular", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      }

      html[data-theme="dark"] {
        color-scheme: dark;
        --bg: #0b1220;
        --surface: #101a2c;
        --surface-soft: #14233a;
        --text: #e8eefb;
        --muted: #9eacc5;
        --line: #253750;
        --line-strong: #36547c;
        --accent-soft: #8db0ff;
        --focus: #8db0ff;
      }

      * {
        box-sizing: border-box;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      *::-webkit-scrollbar {
        width: 0 !important;
        height: 0 !important;
        display: none;
      }

      html,
      body {
        margin: 0;
        min-height: 100%;
      }

      html {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      html::-webkit-scrollbar {
        width: 0;
        height: 0;
      }

      body {
        font-family: var(--font-ui);
        color: var(--text);
        background:
          radial-gradient(920px 520px at 8% -24%, rgba(72, 108, 240, 0.13), transparent 70%),
          radial-gradient(760px 460px at 92% -22%, rgba(57, 103, 255, 0.1), transparent 72%),
          var(--bg);
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      body::-webkit-scrollbar {
        width: 0;
        height: 0;
      }

      .shell {
        width: 100%;
        margin: 0 auto 80px;
      }

      main {
        width: min(1320px, 100% - 28px);
        margin: 34px auto 0;
      }

      .tasks-hero h1 {
        margin: 0;
        font-family: var(--font-head);
        font-size: clamp(1.38rem, 2.45vw, 2rem);
        line-height: 1.08;
        letter-spacing: -0.02em;
      }

      .tasks-hero p {
        margin: 10px 0 0;
        color: var(--muted);
        max-width: 78ch;
        font-size: 0.97rem;
        line-height: 1.6;
      }

      .tasks-controls {
        margin-top: 22px;
        border: 1px solid var(--line);
        background: color-mix(in srgb, var(--surface) 97%, var(--surface-soft) 3%);
      }

      .tasks-toolbar {
        display: grid;
        grid-template-columns: 220px minmax(240px, 1fr) minmax(240px, 1fr) auto;
      }

      .filter-field {
        border-right: 1px solid var(--line);
        padding: 12px 14px;
      }

      .filter-label {
        display: block;
        margin-bottom: 6px;
        color: var(--muted);
        font-size: 11px;
        line-height: 1.2;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-weight: 700;
      }

      .filter-field select,
      .filter-field input {
        width: 100%;
        height: 34px;
        border: 1px solid var(--line);
        border-radius: 0;
        background: var(--surface);
        color: var(--text);
        padding: 0 10px;
        font-size: 13px;
        font-weight: 600;
        font-family: var(--font-ui);
      }

      .filter-field input::placeholder {
        color: color-mix(in srgb, var(--muted) 80%, transparent 20%);
      }

      .filter-field select:focus-visible,
      .filter-field input:focus-visible,
      .clear-btn:focus-visible,
      .page-btn:focus-visible,
      .task-link:focus-visible,
      .task-repo-link:focus-visible {
        outline: 2px solid var(--focus);
        outline-offset: 2px;
      }

      .clear-wrap {
        display: flex;
        align-items: flex-end;
        justify-content: flex-end;
        padding: 12px 14px;
      }

      .clear-btn {
        height: 34px;
        border: 1px solid var(--line);
        border-radius: 0;
        background: var(--surface);
        color: var(--text);
        padding: 0 12px;
        font-size: 12px;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        font-weight: 700;
        cursor: pointer;
      }

      .clear-btn:hover {
        border-color: var(--line-strong);
      }

      .tasks-meta {
        padding: 10px 14px;
        border-top: 1px solid var(--line);
        font-family: var(--font-mono);
        font-size: 12px;
        color: var(--muted);
      }

      .tasks-pagination {
        border: 1px solid var(--line);
        border-top: 0;
        padding: 10px 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        background: color-mix(in srgb, var(--surface) 97%, var(--surface-soft) 3%);
      }

      .page-btn {
        height: 28px;
        min-width: 62px;
        border: 1px solid var(--line);
        border-radius: 0;
        background: var(--surface);
        color: var(--text);
        font-family: var(--font-mono);
        font-size: 12px;
        line-height: 1;
        cursor: pointer;
      }

      .page-btn:hover {
        border-color: var(--line-strong);
      }

      .page-btn:disabled {
        cursor: default;
        opacity: 0.45;
      }

      .page-info {
        margin: 0;
        font-family: var(--font-mono);
        font-size: 12px;
        color: var(--muted);
      }

      .tasks-grid {
        margin-top: 0;
        border: 1px solid var(--line);
        border-top: 0;
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }

      .task-card {
        min-height: 290px;
        padding: 16px 16px 14px;
        border-right: 1px solid var(--line);
        border-bottom: 1px solid var(--line);
        background: color-mix(in srgb, var(--surface) 98%, var(--surface-soft) 2%);
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .task-card-top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }

      .task-split {
        margin: 0;
        font-family: var(--font-mono);
        font-size: 11px;
        line-height: 1.2;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--muted);
      }

      .task-repo-link {
        margin: 0;
        text-decoration: none;
        color: var(--text);
        font-size: 12px;
        line-height: 1.2;
        font-weight: 600;
      }

      .task-repo-link:hover {
        text-decoration: underline;
        text-underline-offset: 2px;
      }

      .task-title {
        margin: 0;
        font-family: var(--font-head);
        font-size: clamp(0.92rem, 1.15vw, 1.05rem);
        line-height: 1.36;
        letter-spacing: -0.01em;
        font-weight: 700;
      }

      .task-preview {
        margin: 0;
        color: var(--muted);
        font-size: 0.88rem;
        line-height: 1.46;
        white-space: pre-wrap;
        word-break: break-word;
        overflow: hidden;
      }

      .task-footer {
        margin-top: auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }

      .task-case {
        margin: 0;
        color: var(--muted);
        font-family: var(--font-mono);
        font-size: 11px;
        line-height: 1.3;
      }

      .task-link {
        width: 24px;
        height: 24px;
        border: 1px solid var(--line);
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: var(--text);
        text-decoration: none;
        background: color-mix(in srgb, var(--surface) 96%, var(--surface-soft) 4%);
      }

      .task-link:hover {
        border-color: var(--line-strong);
      }

      .task-link svg {
        width: 13px;
        height: 13px;
        display: block;
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }

      .tasks-empty {
        margin: 0;
        border: 1px solid var(--line);
        border-top: 0;
        padding: 16px;
        color: var(--muted);
        font-size: 0.96rem;
      }

      .tasks-loading {
        margin: 14px 0 0;
        color: var(--muted);
        font-size: 0.96rem;
      }

      @media (max-width: 1120px) {
        .tasks-toolbar {
          grid-template-columns: 1fr 1fr;
        }

        .filter-field:nth-child(2) {
          border-right: 0;
        }

        .filter-field:nth-child(3),
        .clear-wrap {
          border-top: 1px solid var(--line);
        }

        .tasks-grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      @media (max-width: 760px) {
        main {
          width: min(1320px, 100% - 16px);
          margin-top: 30px;
        }

        .tasks-toolbar {
          grid-template-columns: 1fr;
        }

        .filter-field,
        .clear-wrap {
          border-right: 0;
          border-top: 1px solid var(--line);
        }

        .filter-field:first-child {
          border-top: 0;
        }

        .tasks-grid {
          grid-template-columns: 1fr;
        }

        .task-card {
          min-height: auto;
        }
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <header class="topbar">
        <div class="topbar-content">
          <div class="topbar-left">
            <a class="brand-home" href="../">
              <img src="../leaderboard/logos/logo.jpg" alt="FeatureBench fox logo" />
              <span>FeatureBench</span>
            </a>

            <nav class="main-nav" aria-label="Primary">
              <a href="../leaderboard/">Leaderboard</a>
              <a href="./" aria-current="page">Tasks</a>
              <a href="../news/">News</a>
            </nav>
          </div>

          <div class="topbar-right" aria-label="Theme and links">
            <button class="icon-btn" id="themeLight" type="button" aria-label="Use light theme" aria-pressed="false" title="Light">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <circle cx="12" cy="12" r="4.5" stroke="currentColor" stroke-width="1.9" />
                <path
                  d="M12 2.5v2.3M12 19.2v2.3M4.9 4.9l1.6 1.6M17.5 17.5l1.6 1.6M2.5 12h2.3M19.2 12h2.3M4.9 19.1l1.6-1.6M17.5 6.5l1.6-1.6"
                  stroke="currentColor"
                  stroke-width="1.9"
                  stroke-linecap="round"
                />
              </svg>
            </button>
            <button class="icon-btn" id="themeDark" type="button" aria-label="Use dark theme" aria-pressed="false" title="Dark">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path
                  d="M20 14.4a8.7 8.7 0 1 1-10.4-10.4A7 7 0 0 0 20 14.4Z"
                  stroke="currentColor"
                  stroke-width="1.9"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <a
              class="icon-btn"
              href="https://github.com/LiberCoders/FeatureBench"
              target="_blank"
              rel="noopener noreferrer"
              aria-label="Open GitHub"
              title="GitHub"
            >
              <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path
                  d="M12 .5a12 12 0 0 0-3.79 23.39c.6.11.82-.26.82-.58v-2.2c-3.34.73-4.04-1.42-4.04-1.42-.55-1.39-1.33-1.76-1.33-1.76-1.09-.74.09-.73.09-.73 1.2.08 1.83 1.23 1.83 1.23 1.08 1.84 2.82 1.31 3.5 1 .11-.78.42-1.31.76-1.61-2.67-.3-5.47-1.34-5.47-5.95 0-1.31.47-2.39 1.23-3.23-.12-.31-.53-1.54.12-3.21 0 0 1.01-.32 3.3 1.23A11.4 11.4 0 0 1 12 6.8c1.01 0 2.03.14 2.98.42 2.29-1.55 3.3-1.23 3.3-1.23.65 1.67.24 2.9.12 3.21.77.84 1.23 1.92 1.23 3.23 0 4.62-2.81 5.64-5.49 5.94.43.38.81 1.13.81 2.28v3.38c0 .32.22.7.82.58A12 12 0 0 0 12 .5Z"
                />
              </svg>
            </a>
          </div>
        </div>
      </header>

      <main>
        <section class="tasks-hero">
          <h1>Tasks</h1>
          <p>
            Browse all FeatureBench problem statements copied into this site, with filters for split and repository.
          </p>
        </section>

        <section class="tasks-controls" aria-label="Task filters">
          <div class="tasks-toolbar">
            <label class="filter-field" for="splitFilter">
              <span class="filter-label">Split</span>
              <select id="splitFilter">
                <option value="all">All splits</option>
                <option value="lite">Lite</option>
                <option value="full">Full</option>
              </select>
            </label>

            <label class="filter-field" for="repoFilter">
              <span class="filter-label">Repository</span>
              <select id="repoFilter">
                <option value="all">All repositories</option>
              </select>
            </label>

            <label class="filter-field" for="queryFilter">
              <span class="filter-label">Search</span>
              <input id="queryFilter" type="search" placeholder="Search title or description" />
            </label>

            <div class="clear-wrap">
              <button class="clear-btn" id="clearFilters" type="button">Clear Filters</button>
            </div>
          </div>

          <div class="tasks-meta" id="tasksMeta">Loading tasks...</div>
        </section>

        <p class="tasks-loading" id="tasksLoading">Reading local task index...</p>

        <section class="tasks-grid" id="tasksGrid" aria-live="polite" hidden></section>
        <div class="tasks-pagination" id="tasksPagination" hidden>
          <button class="page-btn" id="pagePrev" type="button">Prev</button>
          <p class="page-info" id="pageInfo">Page 1 / 1</p>
          <button class="page-btn" id="pageNext" type="button">Next</button>
        </div>
        <p class="tasks-empty" id="tasksEmpty" hidden>No tasks match the current filters.</p>
      </main>
    </div>

    <template id="taskCardTemplate">
      <article class="task-card">
        <div class="task-card-top">
          <p class="task-split"></p>
          <a class="task-repo-link" target="_blank" rel="noopener noreferrer">repo</a>
        </div>
        <h2 class="task-title"></h2>
        <p class="task-preview"></p>
        <div class="task-footer">
          <p class="task-case"></p>
          <a class="task-link" target="_blank" rel="noopener noreferrer" aria-label="Open problem statement" title="Open problem statement">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M8 16L16 8" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" />
              <path d="M9 8H16V15" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span class="sr-only">Open problem statement</span>
          </a>
        </div>
      </article>
    </template>

    <script>
      (function () {
        const root = document.documentElement;
        const lightBtn = document.getElementById("themeLight");
        const darkBtn = document.getElementById("themeDark");
        const themeStorageKey = "featurebench.theme";

        const splitFilter = document.getElementById("splitFilter");
        const repoFilter = document.getElementById("repoFilter");
        const queryFilter = document.getElementById("queryFilter");
        const clearFiltersBtn = document.getElementById("clearFilters");
        const tasksMeta = document.getElementById("tasksMeta");
        const tasksLoading = document.getElementById("tasksLoading");
        const tasksGrid = document.getElementById("tasksGrid");
        const tasksPagination = document.getElementById("tasksPagination");
        const pagePrev = document.getElementById("pagePrev");
        const pageNext = document.getElementById("pageNext");
        const pageInfo = document.getElementById("pageInfo");
        const tasksEmpty = document.getElementById("tasksEmpty");
        const cardTemplate = document.getElementById("taskCardTemplate");

        const state = {
          payload: null,
          split: "all",
          repo: "all",
          query: "",
          perPage: 9,
          page: 1,
        };

        function applyTheme(theme) {
          const safe = theme === "dark" ? "dark" : "light";
          root.dataset.theme = safe;
          lightBtn.classList.toggle("active", safe === "light");
          darkBtn.classList.toggle("active", safe === "dark");
          lightBtn.setAttribute("aria-pressed", safe === "light" ? "true" : "false");
          darkBtn.setAttribute("aria-pressed", safe === "dark" ? "true" : "false");
          try {
            localStorage.setItem(themeStorageKey, safe);
          } catch {
            // ignore
          }
        }

        function initTheme() {
          let stored = "light";
          try {
            stored = localStorage.getItem(themeStorageKey) || "light";
          } catch {
            stored = "light";
          }
          applyTheme(stored);
        }

        function compactText(value, maxLen) {
          const trimmed = (value || "").replace(/\s+/g, " ").trim();
          if (trimmed.length <= maxLen) {
            return trimmed;
          }
          return trimmed.slice(0, maxLen - 1).trimEnd() + "...";
        }

        function splitLabel(split) {
          if (split === "lite") return "Lite";
          if (split === "full") return "Full";
          return split;
        }

        function repoGitHubUrl(repo) {
          return "https://github.com/" + repo;
        }

        function buildRepoFilterOptions(repos) {
          const previous = repoFilter.value;
          repoFilter.innerHTML = '<option value="all">All repositories</option>';

          for (const repo of repos) {
            const option = document.createElement("option");
            option.value = repo;
            option.textContent = repo;
            repoFilter.appendChild(option);
          }

          if (repos.includes(previous)) {
            repoFilter.value = previous;
          } else {
            repoFilter.value = "all";
          }
        }

        function getFilteredItems() {
          if (!state.payload) return [];
          const q = state.query.trim().toLowerCase();

          return state.payload.items.filter((item) => {
            if (state.split !== "all" && item.split !== state.split) {
              return false;
            }
            if (state.repo !== "all" && item.repo !== state.repo) {
              return false;
            }
            if (!q) {
              return true;
            }
            const previewText = item.preview_md || item.preview || "";
            const haystack = (item.title + " " + previewText + " " + item.repo + " " + item.case).toLowerCase();
            return haystack.includes(q);
          });
        }

        function updateMeta(filteredCount, start, shownCount) {
          if (!state.payload) {
            tasksMeta.textContent = "No task index loaded.";
            return;
          }

          const counts = state.payload.counts || { lite: 0, full: 0, total: 0 };
          const from = filteredCount === 0 ? 0 : start + 1;
          const to = start + shownCount;
          tasksMeta.textContent =
            "Showing " + from + "-" + to + " of " + filteredCount + " filtered" + " / " +
            counts.total +
            " tasks" +
            " | Lite " +
            counts.lite +
            " | Full " +
            counts.full;
        }

        function updatePagination(totalItems, totalPages) {
          if (totalItems === 0) {
            tasksPagination.hidden = true;
            return;
          }
          tasksPagination.hidden = false;
          pageInfo.textContent = "Page " + state.page + " / " + totalPages;
          pagePrev.disabled = state.page <= 1;
          pageNext.disabled = state.page >= totalPages;
        }

        function renderTasks() {
          const items = getFilteredItems();
          const totalPages = Math.max(1, Math.ceil(items.length / state.perPage));
          state.page = Math.max(1, Math.min(state.page, totalPages));
          const start = (state.page - 1) * state.perPage;
          const pageItems = items.slice(start, start + state.perPage);
          updateMeta(items.length, start, pageItems.length);
          updatePagination(items.length, totalPages);

          tasksGrid.innerHTML = "";

          if (items.length === 0) {
            tasksGrid.hidden = true;
            tasksPagination.hidden = true;
            tasksEmpty.hidden = false;
            return;
          }

          const fragment = document.createDocumentFragment();
          for (const item of pageItems) {
            const card = cardTemplate.content.cloneNode(true);
            const splitEl = card.querySelector(".task-split");
            const repoLink = card.querySelector(".task-repo-link");
            const titleEl = card.querySelector(".task-title");
            const previewEl = card.querySelector(".task-preview");
            const caseEl = card.querySelector(".task-case");
            const statementLink = card.querySelector(".task-link");

            splitEl.textContent = splitLabel(item.split);
            repoLink.textContent = item.repo;
            repoLink.href = repoGitHubUrl(item.repo);

            titleEl.textContent = item.title;
            const previewText = item.preview_md || compactText(item.preview, 320);
            previewEl.textContent = previewText;

            caseEl.textContent = item.case;
            const viewerParams = new URLSearchParams({
              path: item.statement_path,
              title: item.title || item.case,
              split: item.split,
              repo: item.repo,
              case: item.case,
            });
            statementLink.href = "./viewer.html?" + viewerParams.toString();
            statementLink.target = "_self";
            statementLink.rel = "";

            fragment.appendChild(card);
          }

          tasksGrid.appendChild(fragment);
          tasksEmpty.hidden = true;
          tasksGrid.hidden = false;
        }

        function onFilterChange() {
          state.split = splitFilter.value;
          state.repo = repoFilter.value;
          state.query = queryFilter.value || "";
          state.page = 1;
          renderTasks();
        }

        function goPrevPage() {
          if (state.page <= 1) return;
          state.page -= 1;
          renderTasks();
        }

        function goNextPage() {
          const totalItems = getFilteredItems().length;
          const totalPages = Math.max(1, Math.ceil(totalItems / state.perPage));
          if (state.page >= totalPages) return;
          state.page += 1;
          renderTasks();
        }

        function clearFilters() {
          splitFilter.value = "all";
          repoFilter.value = "all";
          queryFilter.value = "";
          state.perPage = 9;
          onFilterChange();
        }

        async function loadTaskIndex() {
          try {
            const response = await fetch("./data/tasks_index.json", { cache: "no-store" });
            if (!response.ok) {
              throw new Error("Failed to load task index: HTTP " + response.status);
            }

            const payload = await response.json();
            if (!payload || !Array.isArray(payload.items)) {
              throw new Error("Invalid task index payload.");
            }

            state.payload = payload;
            buildRepoFilterOptions(payload.repos || []);
            tasksLoading.hidden = true;
            renderTasks();
          } catch (error) {
            tasksLoading.hidden = false;
            tasksLoading.textContent =
              "Could not load tasks/data/tasks_index.json. Run: node tasks/scripts/build_tasks_index.mjs";
            tasksMeta.textContent = "Task index unavailable.";
            tasksGrid.hidden = true;
            tasksPagination.hidden = true;
            tasksEmpty.hidden = true;
            console.error(error);
          }
        }

        initTheme();
        lightBtn.addEventListener("click", () => applyTheme("light"));
        darkBtn.addEventListener("click", () => applyTheme("dark"));

        splitFilter.addEventListener("change", onFilterChange);
        repoFilter.addEventListener("change", onFilterChange);
        queryFilter.addEventListener("input", onFilterChange);
        clearFiltersBtn.addEventListener("click", clearFilters);
        pagePrev.addEventListener("click", goPrevPage);
        pageNext.addEventListener("click", goNextPage);

        loadTaskIndex();
      })();
    </script>
  </body>
</html>
